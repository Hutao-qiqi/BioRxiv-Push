# 系统改造说明

## 📝 改造概览

本项目从原 arXivPush（基于 Discord 的 arXiv 论文推送系统）改造为 **BioRxiv 肿瘤学文章自动阅读与邮件推送系统**。

---

## 🔄 核心改动

### 1. 数据源切换：arXiv → BioRxiv

| 项目 | 原系统 | 新系统 |
|------|--------|--------|
| 数据源 | arXiv API | BioRxiv RSS Feed |
| 领域 | 计算机科学 (cs.CV, cs.LG 等) | 生物医学 (肿瘤学、癌症生物学) |
| 文章获取模块 | `arxiv_fetch.py` | `biorxiv_fetch.py` (全新) |
| 分类方式 | arXiv 分类系统 | BioRxiv 学科分类 + 关键词 |

**技术实现**：
- 使用 `feedparser` 库解析 BioRxiv RSS Feed
- 支持多个 RSS 源（癌症生物学、细胞生物学、免疫学等）
- 基于关键词智能过滤（any/all 模式）

### 2. LLM 切换：Ollama → SiliconFlow API

| 项目 | 原系统 | 新系统 |
|------|--------|--------|
| LLM 服务 | 本地 Ollama (qwen2.5:7b) | SiliconFlow API |
| 模型 | Qwen 2.5 | DeepSeek V3.2 Exp |
| 部署方式 | 需本地安装 Ollama | 无需本地部署，直接调用 API |
| 资源占用 | 占用 GPU/内存 | 零本地资源占用 |
| 摘要生成模块 | `summarizer.py` | `summarizer_api.py` (全新) |

**为什么选择 SiliconFlow API？**
1. **性能强大**：DeepSeek V3.2 是目前最强的中文开源大模型
2. **成本低廉**：比 GPT-4 便宜很多，适合长期运行
3. **易于部署**：不需要本地 GPU，不占用您的 3090 资源
4. **稳定可靠**：云端服务，24/7 可用

**技术实现**：
- 使用 `requests` 库调用 RESTful API
- 自定义 Prompt 模板，针对肿瘤学领域优化
- 支持中文摘要生成，格式专业

### 3. 推送方式切换：Discord → 邮件

| 项目 | 原系统 | 新系统 |
|------|--------|--------|
| 推送渠道 | Discord 机器人 | SMTP 邮件 |
| 交互方式 | Discord 命令 | 邮件接收 |
| 消息格式 | Markdown (Discord) | HTML 邮件 |
| 依赖 | discord.py | smtplib (Python 标准库) |
| 推送模块 | 集成在 `bot.py` | `email_sender.py` (全新) |

**邮件功能特性**：
- 精美的 HTML 格式
- Markdown 自动转 HTML
- 支持主流邮箱服务（QQ、163、Gmail等）
- 错误通知邮件
- 多收件人支持（可扩展）

**技术实现**：
- 使用 Python 标准库 `smtplib` 发送邮件
- 使用 `markdown` 库将 Markdown 转 HTML
- CSS 样式美化邮件
- 支持 STARTTLS 和 SSL 两种加密方式

### 4. 主程序重构：bot.py → biorxiv_bot.py

| 项目 | 原系统 | 新系统 |
|------|--------|--------|
| 主程序 | `bot.py` | `biorxiv_bot.py` (重构) |
| 运行方式 | Discord Bot 事件循环 | 定时任务调度 |
| 交互方式 | Discord 命令 | 命令行参数 |
| 依赖 | discord.py | 纯 Python (无 Discord 依赖) |

**移除的功能**：
- ❌ Discord Bot 所有功能
- ❌ Discord 命令系统 (arxiv-smi, arxiv-rn 等)
- ❌ Discord 消息监听与对话
- ❌ Discord Embed 格式化

**新增的功能**：
- ✅ 独立运行模式（无需 Discord）
- ✅ 命令行管理接口
- ✅ 简洁的状态监控
- ✅ 快速启动脚本

**技术实现**：
- 保留 `APScheduler` 定时任务调度
- 使用 `asyncio` 异步运行
- 命令行参数解析
- 进程管理（后台运行支持）

---

## 📦 新增文件

| 文件名 | 说明 |
|--------|------|
| `biorxiv_fetch.py` | BioRxiv RSS Feed 文章获取模块 |
| `summarizer_api.py` | SiliconFlow API 摘要生成模块 |
| `email_sender.py` | SMTP 邮件发送模块 |
| `biorxiv_bot.py` | 重构后的主程序 |
| `config.yaml` | 肿瘤学关键词配置 |
| `env_template.txt` | 环境变量配置模板 |
| `部署指南.md` | 详细部署文档（中文） |
| `README_BIORXIV.md` | 项目说明文档（中文） |
| `改造说明.md` | 本文件 |
| `快速启动.sh` | 一键启动脚本 |

---

## 🔧 修改的文件

| 文件名 | 修改内容 |
|--------|----------|
| `requirements.txt` | 移除 discord.py 和 arxiv，添加 feedparser 和 markdown |
| `config.yaml.template` | 保留作为参考 |

---

## 🗑️ 不再使用的文件

以下文件在新系统中不再使用（但保留在项目中）：

| 文件名 | 说明 |
|--------|------|
| `bot.py` | 原 Discord Bot 主程序 |
| `arxiv_fetch.py` | 原 arXiv 文章获取模块 |
| `summarizer.py` | 原 Ollama 摘要生成模块 |
| `audioop.py` | Discord 相关 |

> 💡 **建议**：这些文件可以保留作为参考，或者删除以保持项目整洁。

---

## 📊 依赖变化

### 移除的依赖

```diff
- discord.py==2.4.0    # Discord Bot
- arxiv==2.1.3         # arXiv API
```

### 新增的依赖

```diff
+ feedparser==6.0.11   # RSS Feed 解析
+ markdown==3.5.1      # Markdown → HTML
```

### 保留的依赖

```
python-dotenv==1.0.1       # 环境变量
apscheduler==3.10.4        # 定时任务
pytz==2024.1               # 时区
python-dateutil==2.9.0     # 日期处理
requests==2.32.3           # HTTP 请求
pyyaml==6.0.2              # YAML 配置
```

---

## 🎯 配置文件变化

### config.yaml

```yaml
# 原配置
categories:
  - cs.CV
  - cs.LG
  - eess.IV

queries:
  - any:
    - machine learning
    - deep learning

# 新配置
queries:
  - any:
    - oncology
    - cancer
    - tumor
  - any:
    - immunotherapy
    - CAR-T
    - checkpoint inhibitor
```

### .env

```ini
# 原配置
DISCORD_BOT_TOKEN=xxx

# 新配置
SILICONFLOW_API_KEY=sk-xxx
SMTP_SERVER=smtp.qq.com
SMTP_PORT=587
SMTP_SENDER_EMAIL=xxx@qq.com
SMTP_PASSWORD=authorization_code
EMAIL_RECIPIENT=xxx@qq.com
```

---

## 🚀 部署流程对比

### 原系统部署

1. 安装 Ollama
2. 拉取 Qwen 模型
3. 启动 Ollama 服务
4. 创建 Discord Bot
5. 获取 Discord Token
6. 配置 Discord Channel ID
7. 运行 bot.py

### 新系统部署

1. 安装 Python 依赖
2. 配置邮箱 SMTP（获取授权码）
3. 配置 API 密钥（已提供）
4. 运行 biorxiv_bot.py

**部署简化程度**：新系统部署步骤减少约 60%，无需 GPU 资源。

---

## 💰 成本对比

### 原系统

- **硬件成本**：需占用 GPU（本地运行 Qwen 2.5:7b 约需 8-16GB 显存）
- **电费成本**：GPU 持续运行
- **维护成本**：需管理 Ollama 服务

### 新系统

- **硬件成本**：零（API 云端运行）
- **API 费用**：DeepSeek V3.2 约 ¥0.001/1K tokens（极低）
- **维护成本**：低（无需管理本地模型）

**估算**：每天 2 次报告，每次处理 20 篇文章，每月约消耗 ¥10-30 API 费用。

---

## 📈 性能对比

| 指标 | 原系统 (Ollama) | 新系统 (API) |
|------|----------------|-------------|
| 启动速度 | 慢（需加载模型） | 快（无需本地模型） |
| 生成速度 | 中等（取决于 GPU） | 快（云端并行处理） |
| 资源占用 | 高（GPU + 内存） | 极低（仅网络） |
| 稳定性 | 依赖本地环境 | 高（云端服务） |
| 摘要质量 | 好（Qwen 2.5） | 优秀（DeepSeek V3.2） |

---

## 🎓 技术优势

### 1. 数据源优势

- **BioRxiv**：生物医学预印本平台，更新及时
- **肿瘤聚焦**：精准匹配肿瘤学研究，减少噪音
- **RSS Feed**：轻量级，易于解析

### 2. 模型优势

- **DeepSeek V3.2**：中文理解能力强，适合生成中文摘要
- **API 调用**：无需本地 GPU，节省资源
- **专业模板**：针对肿瘤学领域优化 Prompt

### 3. 推送优势

- **邮件推送**：更正式、专业
- **HTML 格式**：美观易读
- **存档方便**：邮箱自动存档，方便回顾

### 4. 运维优势

- **轻量部署**：无需 Ollama、无需 Discord
- **易于监控**：命令行状态查看
- **灵活扩展**：易于添加新功能

---

## 🔮 未来扩展方向

### 短期（1-3个月）

1. ✅ 支持更多 BioRxiv 分类（神经科学、药理学等）
2. ✅ 添加论文筛选评分系统（基于引用、期刊影响因子）
3. ✅ 多收件人配置
4. ✅ 移动端推送（微信、钉钉）

### 中期（3-6个月）

1. ✅ Web 管理界面
2. ✅ 论文全文下载与存档
3. ✅ 智能推荐系统（基于用户阅读历史）
4. ✅ 数据库存储（历史记录查询）

### 长期（6-12个月）

1. ✅ 多用户系统
2. ✅ 自定义 AI 模型微调（针对特定研究方向）
3. ✅ 论文关系图谱
4. ✅ 移动 App

---

## 📝 总结

### 改造效果

- ✅ **成功切换**：arXiv → BioRxiv
- ✅ **领域聚焦**：计算机科学 → 肿瘤学
- ✅ **AI 升级**：Ollama → DeepSeek V3.2
- ✅ **推送优化**：Discord → 邮件
- ✅ **部署简化**：7步 → 4步

### 优势总结

1. **资源节省**：无需占用 GPU，释放 3090 用于其他任务
2. **成本低廉**：API 费用极低（月均 ¥10-30）
3. **部署简单**：无需 Ollama、无需 Discord
4. **专业性强**：聚焦肿瘤学，摘要更专业
5. **易于使用**：邮件推送，随时随地查看

### 适用人群

- 🔬 肿瘤学研究人员
- 🎓 医学院学生
- 💊 制药行业从业者
- 🏥 临床医生
- 📚 科研爱好者

---

**🎉 改造完成！感谢使用！**

