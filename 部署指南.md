# BioRxiv 肿瘤学文章自动阅读系统 - 完整部署指南

## 📋 目录

1. [系统简介](#系统简介)
2. [环境要求](#环境要求)
3. [快速部署](#快速部署)
4. [配置说明](#配置说明)
5. [运行与管理](#运行与管理)
6. [常见问题](#常见问题)
7. [高级配置](#高级配置)

---

## 🎯 系统简介

本系统基于原 arXivPush 项目改造，实现以下功能：

- ✅ **数据源切换**：从 arXiv 切换到 BioRxiv
- ✅ **领域聚焦**：专注于肿瘤学（Oncology）和癌症生物学（Cancer Biology）
- ✅ **AI 摘要**：使用 SiliconFlow API (DeepSeek V3.2) 生成专业研究简报
- ✅ **邮件推送**：通过 SMTP 邮件发送，替代 Discord
- ✅ **定时任务**：每天自动获取最新文章并生成简报

### 系统架构

```
BioRxiv RSS Feed
       ↓
  文章获取与过滤 (biorxiv_fetch.py)
       ↓
  AI 生成摘要 (summarizer_api.py + DeepSeek V3.2)
       ↓
  邮件发送 (email_sender.py)
       ↓
   用户邮箱
```

---

## 💻 环境要求

### 硬件要求

- **CPU**: 2核心及以上
- **内存**: 4GB 及以上（推荐 8GB）
- **硬盘**: 10GB 可用空间
- **网络**: 稳定的互联网连接

> 💡 **您的服务器配置**：500GB 内存 + 3090 显卡完全满足要求！

### 软件要求

- **操作系统**: Linux (Ubuntu 20.04+ / CentOS 7+)
- **Python**: 3.8 及以上版本
- **必要工具**: pip, git

---

## 🚀 快速部署

### 步骤 1: 克隆项目

```bash
cd /data/lsy
git clone https://github.com/Steven-ZN/arXivPush
cd arXivPush
```

### 步骤 2: 安装 Python 依赖

```bash
# 创建虚拟环境（推荐）
python3 -m venv venv
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 步骤 3: 配置环境变量

```bash
# 复制环境变量模板
cp env_template.txt .env

# 编辑 .env 文件，填写您的配置
nano .env
```

**必须配置的项目**：

```ini
# API 密钥（已为您填写）
SILICONFLOW_API_KEY=

# 邮箱配置（需要您填写）
SMTP_SERVER=smtp.qq.com
SMTP_PORT=587
SMTP_SENDER_EMAIL=your_email@qq.com
SMTP_PASSWORD=your_authorization_code
EMAIL_RECIPIENT=your_email@qq.com
```

### 步骤 4: 配置搜索关键词

配置文件 `config.yaml` 已经为肿瘤学方向预配置好，默认配置包括：

- 肿瘤相关关键词：oncology, cancer, tumor, malignancy 等
- 治疗方法：immunotherapy, chemotherapy, targeted therapy 等
- 免疫治疗：T-cell, CAR-T, checkpoint inhibitor 等
- 生物标志物：biomarker, prognosis, diagnosis 等

您可以根据需要修改 `config.yaml`。

### 步骤 5: 测试运行

```bash
# 测试模式：立即生成一次报告
python3 biorxiv_bot.py test
```

如果一切正常，您将在邮箱收到第一份研究简报！

### 步骤 6: 启动定时服务

```bash
# 前台运行（用于测试）
python3 biorxiv_bot.py

# 后台运行（推荐）
nohup python3 biorxiv_bot.py > biorxiv_push.log 2>&1 &

# 查看进程
ps aux | grep biorxiv_bot
```

---

## ⚙️ 配置说明

### 邮箱配置详解

#### 🔹 QQ 邮箱配置（推荐）

1. **登录 QQ 邮箱网页版**: https://mail.qq.com
2. **进入设置**: 设置 → 账户
3. **开启 IMAP/SMTP 服务**:
   - 找到 "POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"
   - 开启 "IMAP/SMTP 服务"
4. **生成授权码**:
   - 点击"生成授权码"
   - 通过手机验证后会显示一个 16 位授权码
   - **立即保存**（只显示一次）

配置示例：

```ini
SMTP_SERVER=smtp.qq.com
SMTP_PORT=587
SMTP_SENDER_EMAIL=123456789@qq.com
SMTP_PASSWORD=abcdefghijklmnop  # 16位授权码
EMAIL_RECIPIENT=123456789@qq.com
```

#### 🔹 163 邮箱配置

1. 登录 163 邮箱: https://mail.163.com
2. 设置 → POP3/SMTP/IMAP
3. 开启"IMAP/SMTP服务"并获取授权码

配置示例：

```ini
SMTP_SERVER=smtp.163.com
SMTP_PORT=587
SMTP_SENDER_EMAIL=yourname@163.com
SMTP_PASSWORD=your_authorization_code
EMAIL_RECIPIENT=yourname@163.com
```

#### 🔹 Gmail 配置

1. 开启"两步验证"
2. 生成"应用专用密码"
3. 使用应用专用密码作为 SMTP_PASSWORD

配置示例：

```ini
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_SENDER_EMAIL=yourname@gmail.com
SMTP_PASSWORD=app_specific_password
EMAIL_RECIPIENT=yourname@gmail.com
```

---

## 🎮 运行与管理

### 命令行操作

```bash
# 启动服务（前台运行）
python3 biorxiv_bot.py

# 启动服务（后台运行）
nohup python3 biorxiv_bot.py > biorxiv_push.log 2>&1 &

# 查看系统状态
python3 biorxiv_bot.py status

# 手动运行一次（自动判断早报/晚报）
python3 biorxiv_bot.py run

# 手动运行早报
python3 biorxiv_bot.py run am

# 手动运行晚报
python3 biorxiv_bot.py run pm

# 测试模式
python3 biorxiv_bot.py test
```

### 查看日志

```bash
# 实时查看日志
tail -f biorxiv_push.log

# 查看最近 50 行日志
tail -n 50 biorxiv_push.log

# 搜索错误信息
grep -i error biorxiv_push.log
```

### 停止服务

```bash
# 查找进程 ID
ps aux | grep biorxiv_bot

# 停止进程（将 PID 替换为实际的进程 ID）
kill PID

# 强制停止（如果普通 kill 无效）
kill -9 PID
```

### 设置开机自启动

创建 systemd 服务文件：

```bash
sudo nano /etc/systemd/system/biorxiv-push.service
```

填入以下内容（修改路径）：

```ini
[Unit]
Description=BioRxiv Oncology Paper Push Service
After=network.target

[Service]
Type=simple
User=lsy
WorkingDirectory=/data/lsy/arXivPush
Environment="PATH=/data/lsy/arXivPush/venv/bin:/usr/bin"
ExecStart=/data/lsy/arXivPush/venv/bin/python3 /data/lsy/arXivPush/biorxiv_bot.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

启用服务：

```bash
# 重新加载 systemd 配置
sudo systemctl daemon-reload

# 启动服务
sudo systemctl start biorxiv-push

# 设置开机自启动
sudo systemctl enable biorxiv-push

# 查看服务状态
sudo systemctl status biorxiv-push

# 查看服务日志
sudo journalctl -u biorxiv-push -f
```

---

## 🔧 常见问题

### Q1: 邮件发送失败？

**可能原因**：
1. 授权码填写错误（不是登录密码！）
2. 未开启 IMAP/SMTP 服务
3. 防火墙阻止 SMTP 端口
4. 邮箱服务器限制

**解决方案**：

```bash
# 查看详细错误日志
tail -f biorxiv_push.log | grep -i "email\|smtp"

# 测试 SMTP 连接
telnet smtp.qq.com 587

# 如果连接失败，检查防火墙
sudo ufw status
sudo ufw allow 587/tcp
```

### Q2: API 调用失败？

**可能原因**：
1. API 密钥错误
2. 网络连接问题
3. API 配额用尽

**解决方案**：

```bash
# 检查 API 密钥是否正确
cat .env | grep SILICONFLOW_API_KEY

# 测试 API 连接
curl -X POST https://api.siliconflow.cn/v1/chat/completions \
  -H "Authorization: Bearer sk-your-key-here" \
  -H "Content-Type: application/json" \
  -d '{"model": "deepseek-ai/DeepSeek-V3.2-Exp", "messages": [{"role": "user", "content": "Hello"}]}'
```

### Q3: 获取不到文章？

**可能原因**：
1. BioRxiv RSS Feed 访问失败
2. 关键词过滤太严格
3. 时间窗口设置不合理

**解决方案**：

```bash
# 测试 RSS Feed 访问
curl https://connect.biorxiv.org/biorxiv_xml.php?subject=cancer_biology

# 修改 config.yaml，放宽关键词限制
nano config.yaml

# 增加时间窗口（例如改为 48 小时）
time_window_hours: 48
```

### Q4: 服务器重启后服务未启动？

**解决方案**：使用上面的 systemd 服务配置，确保开机自启动。

### Q5: 中文乱码问题？

**解决方案**：

```bash
# 设置系统语言环境
export LANG=zh_CN.UTF-8
export LC_ALL=zh_CN.UTF-8

# 添加到 ~/.bashrc 使其永久生效
echo 'export LANG=zh_CN.UTF-8' >> ~/.bashrc
echo 'export LC_ALL=zh_CN.UTF-8' >> ~/.bashrc
source ~/.bashrc
```

---

## 🎓 高级配置

### 自定义关键词

编辑 `config.yaml`：

```yaml
queries:
  - any:  # 任意匹配（包含其中一个即可）
      - breast cancer
      - lung cancer
      - liver cancer
  - all:  # 全部匹配（必须同时包含）
      - CRISPR
      - cancer
```

### 修改报告时间

编辑 `config.yaml`：

```yaml
report_times:
  - '08:00'  # 早上 8 点
  - '14:00'  # 下午 2 点
  - '20:00'  # 晚上 8 点
```

### 调整文章数量

编辑 `config.yaml`：

```yaml
digest_max_items: 30  # 每次报告最多 30 篇文章
abstract_max_chars: 1000  # 摘要最大 1000 字符
```

### 使用代理

如果服务器需要通过代理访问外网，在 `.env` 文件中添加：

```ini
HTTP_PROXY=http://proxy.example.com:8080
HTTPS_PROXY=http://proxy.example.com:8080
```

### 多收件人配置

目前系统只支持单个收件人。如需多收件人，可以修改 `email_sender.py`：

```python
# 在 send_email 函数中修改
recipient_emails = ["email1@example.com", "email2@example.com"]
server.sendmail(sender_email, recipient_emails, msg.as_string())
```

---

## 📊 系统监控

### 实时状态监控

```bash
# 查看系统状态
python3 biorxiv_bot.py status

# 输出示例：
================================================================================
📊 BioRxiv 肿瘤学研究推送系统 - 状态监控
================================================================================

🟢 运行状态: 运行中
⏱️  运行时长: 2:15:30
📈 已生成报告: 5 份
📄 已处理文章: 87 篇
🌐 时区: Asia/Shanghai
⏰ 报送时间: 09:00, 21:00
⌛ 时间窗口: 24 小时
📥 最后获取: 2025-10-17 21:00:15
📧 最后报告: 2025-10-17 21:05:32

📅 定时任务 (2 个):
   • 早报(09:00): 2025-10-18 09:00:00
   • 晚报(21:00): 2025-10-18 21:00:00
```

### 日志分析

```bash
# 统计成功/失败次数
grep "生成并发送成功" biorxiv_push.log | wc -l
grep "失败" biorxiv_push.log | wc -l

# 查看最近的错误
grep -i "error\|fail" biorxiv_push.log | tail -n 10

# 查看今天的活动
grep "$(date +%Y-%m-%d)" biorxiv_push.log
```

---

## 📞 技术支持

### 项目结构

```
arXivPush/
├── biorxiv_bot.py          # 主程序
├── biorxiv_fetch.py        # BioRxiv 文章获取
├── summarizer_api.py       # AI 摘要生成
├── email_sender.py         # 邮件发送
├── state.py                # 状态管理
├── utils.py                # 工具函数
├── config.yaml             # 配置文件
├── .env                    # 环境变量（需创建）
├── env_template.txt        # 环境变量模板
├── requirements.txt        # Python 依赖
└── 部署指南.md             # 本文档
```

### 常用命令速查

| 命令 | 说明 |
|------|------|
| `python3 biorxiv_bot.py` | 启动服务 |
| `python3 biorxiv_bot.py status` | 查看状态 |
| `python3 biorxiv_bot.py run` | 手动运行一次 |
| `python3 biorxiv_bot.py test` | 测试模式 |
| `tail -f biorxiv_push.log` | 查看日志 |
| `ps aux \| grep biorxiv` | 查看进程 |
| `kill PID` | 停止服务 |

---

## 🎉 部署完成！

恭喜您成功部署 BioRxiv 肿瘤学文章自动阅读系统！

系统将在每天的指定时间（默认 09:00 和 21:00）自动：
1. 从 BioRxiv 获取最新的肿瘤学相关文章
2. 使用 AI 生成专业的研究简报
3. 通过邮件发送到您的邮箱

---

**祝您科研顺利！📚🔬**

